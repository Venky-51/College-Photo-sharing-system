<!DOCTYPE html>
<html>
<head>
    <title>Student Gallery</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <h1>Student Photo Gallery</h1>

    <h3>Select Event</h3>

    <select id="eventSelect">
        <option value="">-- Select an Event --</option>
    </select>

    <br><br>
    <button onclick="loadPhotos()">View Photos</button>

    <p id="message"></p>

    <div id="gallery"></div>

    <br><br>
    <button onclick="goBack()">Back to Home</button>

    <script>
    function goBack() {
        window.location.href = "index.html";
    }

    // Load events when page opens
    window.onload = function () {
        fetch("http://localhost:8080/events")
            .then(response => response.json())
            .then(events => {
                const dropdown = document.getElementById("eventSelect");

                events.forEach(event => {
                    const option = document.createElement("option");
                    option.value = event;
                    option.text = event;
                    dropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error(error);
                document.getElementById("message").innerText = "Failed to load events";
            });
    };

    function loadPhotos() {
        const eventName = document.getElementById("eventSelect").value;
        const gallery = document.getElementById("gallery");
        const message = document.getElementById("message");

        gallery.innerHTML = "";
        message.innerText = "";

        if (eventName === "") {
            message.innerText = "Please select an event";
            return;
        }

        fetch("http://localhost:8080/admin/photos/" + eventName)
            .then(response => response.json())
            .then(data => {
                if (data.length === 0) {
                    message.innerText = "No photos found for this event";
                    return;
                }

                data.forEach(url => {

                const container = document.createElement("div");
                container.style.display = "inline-block";
                container.style.margin = "10px";
                container.style.textAlign = "center";

                const img = document.createElement("img");
                img.src = url;
                img.width = 200;
                img.style.display = "block";

                const deleteBtn = document.createElement("button");
                deleteBtn.innerText = "Request Delete";
                deleteBtn.onclick = function () {
                    requestDelete(eventName, url);
                };

                const downloadLink = document.createElement("a");
                downloadLink.href = url;
                downloadLink.innerText = "Download";
                downloadLink.download = "";
                downloadLink.style.display = "block";
                downloadLink.style.marginTop = "5px";


                container.appendChild(img);
                container.appendChild(deleteBtn);
                container.appendChild(downloadLink);

                gallery.appendChild(container);
            });

            })
            .catch(error => {
                console.error(error);
                message.innerText = "Failed to load photos";
            });

        function requestDelete(eventName, imageUrl) {

            const reason = prompt("Enter reason for delete request:");

            if (reason === null || reason.trim() === "") {
                alert("Delete request cancelled");
                return;
            }

            const imageName = imageUrl.substring(imageUrl.lastIndexOf("/") + 1);

            fetch("http://localhost:8080/student/request-delete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    event: eventName,
                    image: imageName,
                    reason: reason
                })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
            })
            .catch(err => {
                console.error(err);
                alert("Failed to submit delete request");
            });
        }

    }
</script>


</body>
</html>
